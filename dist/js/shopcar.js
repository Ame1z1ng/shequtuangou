"use strict";$(function(){var t,c;getCookie("login")?(t=getCookie("username"),c=getCookie("uid"),$("#username").css("display","block").html(t).attr("uid",c),$("#exit").css("display","block"),$("#login").css("display","none"),$(".header_myid").click(function(){location.href="./account.html?msg=myid"}),$(".header_myshopcar").click(function(){location.href="./shopcar.html"}),$(".header_myorder").click(function(){location.href="./account.html?msg=myorder"}),$(".header_help").click(function(){alert('添加微信"nszdppx1234"询问解决方法')}),$("#me").click(function(){location.href="./account.html?msg=myorder"}),$("#shopcargo").click(function(){location.href="./shopcar.html"}),$("#favoritego").click(function(){location.href="./account.html?msg=myfavorite"}),$("#username").click(function(){location.href="./account.html?msg=myid"})):(alert("请先登录"),location.href="./register.html",$("#username").css("display","none"),$("#login").css("display","block"),$("#exit").css("display","none")),$("#exit").click(function(){confirm("确认退出登录吗")&&(setCookie("login","","-1"),setCookie("username","","-1"),setCookie("uid","","-1"),$("#username").removeAttr("uid"),location.reload())}),$("#searchBtn").click(function(){""!=$("#searchIpt").val()?location.href="./search.html?key="+$("#searchIpt").val():alert("请输入关键字再搜索")}),$.ajax({url:"../api/getShopcar.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(c){var o,e;function i(){var t,c=0;for(t in e)c+=e[t].listtotal;$("#sb_right span").html(c),0!=$("#sb_right span").html()?$("#sb_right button").prop("disabled","").css({"background-color":"#4caf50",color:"#fff"}):$("#sb_right button").prop("disabled",!0).css({"background-color":"#f5f5f5",color:"rgba(0,0,0,.25)"})}0!=c.length?($("#shopcarNull").css("display","none"),console.log(c),$("#listNum").html(c.length),o="",c.forEach(function(t){o+='<tr class="shopcar_list">\n                <td class="tdfirst">\n                    <input type="checkbox" class="shopcar_listckb" sid="'+t.id+'">\n                </td>\n                <td class="tdsecond">\n                    <div class="shopcar_listcontent" sid="'+t.goods_id+'">\n                        <img src="'+t.img+'" alt="">\n                        <div class="shopcar_listmsg">\n                            '+t.name+'\n                        </div>\n                    </div>\n                </td>\n                <td class="tdthird">'+t.price+'</td>\n                <td class="tdfourth">\n                        <div>\n                            <input type="number" min="1" max="999" step="1" class="listnum" uid="'+t.id+' "sid="'+t.goods_id+'" value="'+t.goods_num+'">\n                        </div>      \n                </td>\n                <td class="tdfifth">\n                    '+ +t.price*+t.goods_num+'\n                </td>\n                <td class="tdsixth">\n                    <a href="#" class="delshopcar"  sid="'+t.id+'">删除</a>\n                </td>\n            </tr>'}),$("tbody").html(o),e={},$("#allcheck").click(function(){if(0==$("#allcheck").prop("checked"))e={},$(".shopcar_listckb").prop("checked","").parent().parent().css("backgroundColor","");else if(1==$("#allcheck").prop("checked")){$(".shopcar_listckb").prop("checked","checked").parent().parent().css("backgroundColor","#e2f3e3");for(var t=0;t<c.length;t++)e[$($(".shopcar_listckb")[t]).attr("sid")]={listtotal:+$($(".tdfifth")[t]).html()}}console.log(e),i()}),$(".shopcar_listckb").click(function(){for(var t=0;t<$(".shopcar_listckb").length;t++)if(1==$($(".shopcar_listckb")[t]).prop("checked"))$("#allcheck").prop("checked",!0);else if(0==$($(".shopcar_listckb")[t]).prop("checked")){$("#allcheck").prop("checked",!1);break}console.log($(this));var c,o=$(this);if(0==o.prop("checked"))for(var s in o.parent().parent().css("backgroundColor",""),e)s==o.attr("sid")&&delete e[s];else 1==o.prop("checked")&&(o.parent().parent().css("backgroundColor","#e2f3e3"),c=$.inArray(o[0],$(".shopcar_listckb")),e[o.attr("sid")]={listtotal:+$($(".tdfifth")[c]).html()});i()}),$(".tdfourth input").bind("input propertychange",function(){console.log(1),$.ajax({url:"../api/changeCarlistsnum.php",method:"get",dataType:"json",data:{goods_num:$(this).val(),id:$(this).attr("uid")},success:function(t){console.log(t)},error:function(t){console.log(t)}});var t=$.inArray($(this)[0],$(".tdfourth input")),c=$(this).val(),o=$($(".tdthird")[t]).html();$($(".tdfifth")[t]).html(c*o),e[+$(this).attr("uid")].listtotal=c*o,i()}),$(".delshopcar").click(function(){var c=$(this).attr("sid"),o=$(this);confirm("确定要删除吗？")&&$.ajax({url:"../api/delShopcar.php",method:"get",dataType:"json",data:{sid:$(this).attr("sid")},success:function(t){alert(t.msg),o.parent().parent().remove(),delete e[+c],i()},error:function(t){console.log(t)}})}),$("#dellists").click(function(){confirm("确定要删除吗？")&&(Object.keys(e).forEach(function(t){$.ajax({url:"../api/delShopcar.php",method:"get",dataType:"json",data:{sid:+t},success:function(t){console.log(t)},error:function(t){console.log(t)}})}),e={},window.location.reload())})):$("#shopcarNull").css("display","block")},error:function(t){console.log(t)}}),$("#allcheck").click(function(){})});