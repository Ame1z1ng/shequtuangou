"use strict";$(function(){var e,t,s=getCookie("login"),a=getCookie("uid");function i(e){e=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),e=decodeURIComponent(window.location.search).substr(1).match(e);return null!=e?unescape(e[2]):null}s?(s=getCookie("username"),$("#username").css("display","block").html(s).attr("uid",a),$("#exit").css("display","block"),$("#login").css("display","none"),$(".header_myid").click(function(){location.href="./account.html?msg=myid"}),$(".header_myshopcar").click(function(){location.href="./shopcar.html"}),$(".header_myorder").click(function(){location.href="./account.html?msg=myorder"}),$(".header_help").click(function(){alert('添加微信"nszdppx1234"询问解决方法')}),$("#me").click(function(){location.href="./account.html?msg=myorder"}),$("#shopcargo").click(function(){location.href="./shopcar.html"}),$("#favoritego").click(function(){location.href="./account.html?msg=myfavorite"}),$("#username").click(function(){location.href="./account.html?msg=myid"})):(alert("请先登录"),location.href="./register.html",$("#username").css("display","none"),$("#login").css("display","block"),$("#exit").css("display","none")),$("#exit").click(function(){confirm("确认退出登录吗")&&(setCookie("login","","-1"),setCookie("username","","-1"),setCookie("uid","","-1"),$("#username").removeAttr("uid"),location.reload())}),$("#searchBtn").click(function(){""!=$("#searchIpt").val()?location.href="./search.html?key="+$("#searchIpt").val():alert("请输入关键字再搜索")}),$.ajax({url:"../api/getShopcar.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(e){$("#listNum").html(e.length)},error:function(e){console.log(e)}}),"myid"==i("msg")?(e=function(){1==t.telText&&1==t.addressText?$(".eClist_right button").prop("disabled","").css("backgroundColor","#4caf50"):$(".eClist_right button").prop("disabled","true").css("backgroundColor","#b2eeb4")},$("main").html('<div>\n            <h2 class="title_order">基本信息</h2>\n            <div id="essentialInformation">\n                <div class="userinfo">用户信息</div>\n            </div>\n            <div id="essentialContent">\n                <div class="eClist">\n                    <div class="eClist_left"><label for="ecname">用户名:</label></div>\n                    <div class="eClist_right"><input type="text" name="ecname" id="ecname" readonly></div>\n                </div>\n                <div class="eClist">\n                    <div class="eClist_left"><label for="ecsex">性别:</label></div>\n                    <div class="eClist_right"><input type="radio" name="ecsex" style="margin-right: 5px;" checked>男<input type="radio" name="ecsex" style="margin-right: 5px; margin-left: 15px;">女</div>\n                </div>\n                <div class="eClist">\n                    <div class="eClist_left"><label for="ectel">手机号:</label></div>\n                    <div class="eClist_right"><input type="text" name="ectel" id="ectel"></div>\n                </div>\n                <div class="eClist">\n                    <div class="eClist_left"><label for="ecaddress">地址:</label></div>\n                    <div class="eClist_right"><input type="text" name="ecaddress" id="ecaddress"></div>\n                </div>\n                <div class="eClist">\n                    <div class="eClist_left"></div>\n                    <div class="eClist_right">\n                        <button disabled>确认修改</button>\n                    </div>\n                </div>\n            </div>\n        </div>'),$.ajax({url:"../api/userinfo.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(e){console.log(e),$("#ecname").val(e.username),$("#ectel").val(e.tel),$("#ecaddress").val(e.address)},error:function(e){console.log(e)}}),t={addressText:!0,telText:!0},$("#ectel").blur(function(){if(""==$("#ectel").val())return alert("手机号不能为空"),t.telText=!1,void e();/^1[3456789]\d{9}$/.test($("#ectel").val())?t.telText=!0:(alert("手机号码格式错误"),t.telText=!1),e()}),$("#ecaddress").blur(function(){return""==$("#ecaddress").val()?(alert("地址不能为空"),t.addressText=!1):t.addressText=!0,void e()}),e(),$(".eClist_right button").click(function(){$.ajax({url:"../api/changeTelAddress.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid"),tel:$("#ectel").val(),address:$("#ecaddress").val()},success:function(e){console.log(e)},error:function(e){console.log(e)}})})):"myfavorite"==i("msg")?($("main").html('<div>\n            <h2 class="title_order">我的收藏</h2>\n            <div id="favorite_title">\n                            还没有收藏商品哦！去逛逛吧\n                        </div>\n            <div id="favorite">\n                <div class="favorite_list">\n                    \n                </div>\n            </div>\n        </div>'),$.ajax({url:"../api/getMyfavorite.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(e){var t;console.log(e),0!=e.length?($("#favorite_title").css("display","none"),t="",e.forEach(function(e){t+='<div class="favorite_lists">\n                            <div class="favorite_listsimg">\n                                <img src="'+e.listpic+'" alt="">\n                            </div>\n                            <div class="favorite_listsmsg">\n                                '+e.listdescribe+'\n                            </div>\n                            <ul class="operatelist">\n                                <li class="operalist_check" gid="'+e.goods_id+'">查看商品</li>\n                                <li class="operalist_cancel" fid="'+e.id+'">取消收藏</li>\n                            </ul>\n                        </div>'}),$(".favorite_list").html(t),$(".operalist_cancel").click(function(){$.ajax({url:"../api/delMyfavorite.php",method:"get",dataType:"json",data:{fid:$(this).attr("fid")},success:function(e){console.log(e)},error:function(e){console.log(e)}}),$(this).parent().parent().remove()})):$("#favorite_title").css("display","block")},error:function(e){console.log(e)}})):$("main").html('<div>\n            <h2 class="title_order">我的订单</h2>\n            <div id="orderInformation">\n                <div class="orderInformation_list">\n                    <div class="orderInformation_lists">全部订单</div>\n                    <div class="orderInformation_lists">待发货</div>\n                    <div class="orderInformation_lists">待收货</div>\n                    <div class="orderInformation_lists">已完成</div>\n                    <div class="orderInformation_lists">已取消</div>\n                </div>\n                <div class="order_list">\n                                还没有订单信息快去逛逛吧\n                </div>\n            </div>\n\n        </div>'),$(".allist").click(function(e){var t,s,i,n;$(".allist").css({"border-right":"none",backgroundColor:"#fff",color:"#000"}),$(this).css({"border-right":"2px solid #4caf50",backgroundColor:"#d5ebd6",color:"#4caf50"}),e.target.classList.contains("account_myorder")?$("main").html('<div>\n            <h2 class="title_order">我的订单</h2>\n            <div id="orderInformation">\n                <div class="orderInformation_list">\n                    <div class="orderInformation_lists">全部订单</div>\n                    <div class="orderInformation_lists">待发货</div>\n                    <div class="orderInformation_lists">待收货</div>\n                    <div class="orderInformation_lists">已完成</div>\n                    <div class="orderInformation_lists">已取消</div>\n                </div>\n                <div class="order_list">\n                                还没有订单信息快去逛逛吧\n                </div>\n            </div>\n\n        </div>'):e.target.classList.contains("account_myfavorite")?($("main").html('<div>\n            <h2 class="title_order">我的收藏</h2>\n            <div id="favorite_title">\n                            还没有收藏商品哦！去逛逛吧\n                        </div>\n            <div id="favorite">\n                <div class="favorite_list">\n                    \n                </div>\n            </div>\n        </div>'),$.ajax({url:"../api/getMyfavorite.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(e){var t;console.log(e),0!=e.length?($("#favorite_title").css("display","none"),t="",e.forEach(function(e){t+='<div class="favorite_lists">\n                            <div class="favorite_listsimg">\n                                <img src="'+e.listpic+'" alt="">\n                            </div>\n                            <div class="favorite_listsmsg">\n                                '+e.listdescribe+'\n                            </div>\n                            <ul class="operatelist">\n                                <li class="operalist_check" gid="'+e.goods_id+'">查看商品</li>\n                                <li class="operalist_cancel" fid="'+e.id+'">取消收藏</li>\n                            </ul>\n                        </div>'}),$(".favorite_list").html(t),$(".operalist_check").click(function(){location.href="./detailpage.html?goods_id="+$(this).attr("gid")}),$(".operalist_cancel").click(function(){$.ajax({url:"../api/delMyfavorite.php",method:"get",dataType:"json",data:{fid:$(this).attr("fid")},success:function(e){console.log(e)},error:function(e){console.log(e)}}),$(this).parent().parent().remove()})):$("#favorite_title").css("display","block")},error:function(e){console.log(e)}})):e.target.classList.contains("account_myaddress")?($("main").html('<div>\n            <h2 class="title_order">收货地址</h2>\n            <div id="addnew">\n                <span id="addnewCon">\n                    <button id="addbtn">\n                        + 新增收货地址\n                    </button>\n                    <div id="addtable">\n                    <table style="width: 100%;">\n                        <colgroup>\n                            <col style="width: 120px;">\n                            <col style="width: 120px;">\n                            <col style="width: 250px;">\n                            <col>\n                            <col style="width: 110px;">\n                        </colgroup>\n                        <thead>\n                            <tr>\n                                <th><span>收货人</span></th>\n                                <th><span>手机号</span></th>\n                                <th><span>所在地区</span></th>\n                                <th><span>详细地址</span></th>\n                                <th><span>操作</span></th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            \n                        </tbody>\n                    </table>\n                </div>\n                </span>\n            </div>\n\n        </div>'),$.ajax({url:"../api/getaddress.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(s){var t="";s.forEach(function(e){t+="<tr class='address_tr'>\n                    <td>"+e.name+"</td>\n                    <td>"+e.tel+"</td>\n                    <td>"+e.region+"</td>\n                    <td>"+e.address+"</td>\n                    <td pid="+e.id+'>\n                        <span><a href="#">编辑</a></span> |\n                        <span><a href="#">删除</a></span>\n                    </td>\n                </tr>'}),$("tbody").html(t);var i;$("tbody").on("click","a",function(){if(i=$(this).parent().parent().attr("pid"),$("#consigneeipt").attr("pid",i),"编辑"==$(this).html()){$("#newAdd").fadeIn("fast");for(var e={},t=0;t<s.length;t++)if(s[t].id==i){e=s[t];break}$("#consigneeipt").val(e.name),$("#telIpt").val(e.tel),$("#areaIpt").val(e.region),$("#detailaddIpt").val(e.address)}else"删除"==$(this).html()&&confirm("确认删除此地址吗？")&&$.ajax({url:"../api/deladdress.php",method:"get",dataType:"json",data:{id:i},success:function(e){console.log(e),$.ajax({url:"../api/getaddress.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(e){var t="";e.forEach(function(e){t+="<tr class='address_tr'>\n                                                <td>"+e.name+"</td>\n                                                <td>"+e.tel+"</td>\n                                                <td>"+e.region+"</td>\n                                                <td>"+e.address+"</td>\n                                                <td pid="+e.id+'>\n                                                    <span><a href="#">编辑</a></span> |\n                                                    <span><a href="#">删除</a></span>\n                                                </td>\n                                            </tr>'}),$("tbody").html(t)},error:function(e){console.log(e)}})},error:function(e){console.log(e)}})})},error:function(e){console.log(e)}}),$("#addbtn").click(function(){$("#newAdd").fadeIn("fast"),$("#consigneeipt").attr("uid",a),$("#consigneeipt").val(""),$("#telIpt").val(""),$("#areaIpt").val(""),$("#detailaddIpt").val("")})):e.target.classList.contains("account_myself")?(t=function(){1==s.telText&&1==s.addressText?$(".eClist_right button").prop("disabled","").css("backgroundColor","#4caf50"):$(".eClist_right button").prop("disabled","true").css("backgroundColor","#b2eeb4")},$("main").html('<div>\n            <h2 class="title_order">基本信息</h2>\n            <div id="essentialInformation">\n                <div class="userinfo">用户信息</div>\n            </div>\n            <div id="essentialContent">\n                <div class="eClist">\n                    <div class="eClist_left"><label for="ecname">用户名:</label></div>\n                    <div class="eClist_right"><input type="text" name="ecname" id="ecname" readonly></div>\n                </div>\n                <div class="eClist">\n                    <div class="eClist_left"><label for="ecsex">性别:</label></div>\n                    <div class="eClist_right"><input type="radio" name="ecsex" style="margin-right: 5px;" checked>男<input type="radio" name="ecsex" style="margin-right: 5px; margin-left: 15px;">女</div>\n                </div>\n                <div class="eClist">\n                    <div class="eClist_left"><label for="ectel">手机号:</label></div>\n                    <div class="eClist_right"><input type="text" name="ectel" id="ectel"></div>\n                </div>\n                <div class="eClist">\n                    <div class="eClist_left"><label for="ecaddress">地址:</label></div>\n                    <div class="eClist_right"><input type="text" name="ecaddress" id="ecaddress"></div>\n                </div>\n                <div class="eClist">\n                    <div class="eClist_left"></div>\n                    <div class="eClist_right">\n                        <button disabled>确认修改</button>\n                    </div>\n                </div>\n            </div>\n        </div>'),$.ajax({url:"../api/userinfo.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(e){console.log(e),$("#ecname").val(e.username),$("#ectel").val(e.tel),$("#ecaddress").val(e.address)},error:function(e){console.log(e)}}),s={addressText:!0,telText:!0},$("#ectel").blur(function(){if(""==$("#ectel").val())return alert("手机号不能为空"),s.telText=!1,void t();/^1[3456789]\d{9}$/.test($("#ectel").val())?s.telText=!0:(alert("手机号码格式错误"),s.telText=!1),t()}),$("#ecaddress").blur(function(){return""==$("#ecaddress").val()?(alert("地址不能为空"),s.addressText=!1):s.addressText=!0,void t()}),t(),$(".eClist_right button").click(function(){$.ajax({url:"../api/changeTelAddress.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid"),tel:$("#ectel").val(),address:$("#ecaddress").val()},success:function(e){console.log(e)},error:function(e){console.log(e)}})})):e.target.classList.contains("account_mypassword")&&(i=function(){1==n.newpswText&&1==n.pswsureText?$(".cpClist_right button").prop("disabled","").css("backgroundColor","#4caf50"):$(".cpClist_right button").prop("disabled","true").css("backgroundColor","#b2eeb4")},$("main").html('<div>\n                <h2 class="title_order">修改密码</h2>\n                <div id="changePassword">\n                    <div class="userinfo">用户信息</div>\n                </div>\n                <div id="changepswContent">\n                    <div class="cpClist">\n                        <div class="cpClist_left"><label for="cpcname">用户名:</label></div>\n                        <div class="cpClist_right"><input type="text" name="cpcname" id="cpcname" readonly>\n                        </div>\n                    </div>\n                    <div class="cpClist mistake">\n                        <div class="cpClist_left"><label for="oldpsw">旧密码:</label></div>\n                        <div class="cpClist_right">\n                            <input type="password" name="oldpsw" id="oldpsw" readonly>\n                        </div>\n                    </div>\n                    <div class="cpClist" style="height: 88px;">\n                        <div class="cpClist_left"><label for="newpsw">新密码:</label></div>\n                        <div class="cpClist_right"><input type="text" name="newpsw" id="newpsw">\n                        <p>6到18位数字或者字母组成</p>\n                    <span id=falsenewpsw>密码格式错误!</span>\n                </div>\n                    </div>\n                    <div class="cpClist mistake">\n                        <div class="cpClist_left"><label for="pswsure">确认密码:</label></div>\n                        <div class="cpClist_right"><input type="text" name="pswsure" id="pswsure">\n                        <span id=falsepswsure>与上一次输入密码不一致!</span></div>\n                    </div>\n                    <div class="cpClist">\n                        <div class="cpClist_left"></div>\n                        <div class="cpClist_right">\n                            <button disabled>修改密码</button>\n                        </div>\n                    </div>\n                </div>\n            </div>'),$.ajax({url:"../api/userinfo.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(e){console.log(e),$("#cpcname").val(e.username),$("#oldpsw").val(e.password)},error:function(e){console.log(e)}}),n={},$("#newpsw").blur(function(){""!=$("#newpsw").val()?($("#falsenewpsw").css("display","none"),/^[a-zA-Z0-9_-]{6,18}$/.test($("#newpsw").val())?($("#falsenewpsw").css("display","none"),n.newpswText=!0):(n.newpswText=!1,$("#falsenewpsw").css("display","block").html("密码格式错误")),i()):$("#falsenewpsw").css("display","block").html("密码不能为空")}),$("#pswsure").blur(function(){""!=$("#pswsure").val()?($("#falsepswsure").css("display","none"),$("#newpsw").val()==$("#pswsure").val()?(n.pswsureText=!0,$("#falsepswsure").css("display","none")):($("#falsepswsure").css("display","block").html("密码不一致"),n.pswsureText=!1),i()):$("#falsepswsure").css("display","block").html("请确认密码")}),$(".cpClist_right button").click(function(){$.ajax({url:"../api/changepassword.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid"),password:$("#newpsw").val()},success:function(e){console.log(e)},error:function(e){console.log(e)}})}))}),$(".newAdd_headexit").click(function(){$("#newAdd").fadeOut("fast"),$("#consigneeipt").removeAttr("uid")}),$("#footCancel").click(function(){$("#newAdd").fadeOut("fast"),$("#consigneeipt").removeAttr("uid")}),$("#areaIpt").click(function(){$("#address_lists").css("display","block");var e=$("#areaIpt").offsetParent().offset().left+144,t=$("#areaIpt").offsetParent().offset().top+249;$("#address_list").css("left",e+"px").css("top",t+"px"),$.ajax({url:"../api/regionlevelone.php",method:"get",dataType:"json",data:{level:1},success:function(e){var t;0!=e.length?(console.log(e),t="",e.forEach(function(e){t+='<li aid="'+e.id+'" pid="'+e.pid+'">'+e.name+"</li>"}),$(".address_levelone").html(t),$(".address_levelone li").click(function(){$(".address_levelone li").css({"font-weight":"100",color:"rgba(0,0,0,.65)"}).removeClass("levelactive"),$(this).css({"font-weight":"600",color:"rgba(0,0,0,.65)"}).addClass("levelactive"),$(".address_leveltwo").css("display","inline-block"),$(".address_levelthree").css("display","none"),console.log($(this).attr("aid")),$.ajax({url:"../api/regionleveltwo.php",method:"get",dataType:"json",data:{uid:$(this).attr("aid")},success:function(e){var t;0!=e.length?(console.log(e),t="",e.forEach(function(e){t+='<li aid="'+e.id+'" pid="'+e.pid+'">'+e.name+"</li>"}),$(".address_leveltwo").html(t),$(".address_leveltwo li").click(function(){$(".address_leveltwo li").css({"font-weight":"100",color:"rgba(0,0,0,.65)"}).removeClass("levelactive"),$(this).css({"font-weight":"600",color:"rgba(0,0,0,.65)"}).addClass("levelactive"),$(".address_levelthree").css("display","inline-block"),$.ajax({url:"../api/regionleveltwo.php",method:"get",dataType:"json",data:{uid:$(this).attr("aid")},success:function(e){var t;0!=e.length?(console.log(e),t="",e.forEach(function(e){t+='<li aid="'+e.id+'" pid="'+e.pid+'">'+e.name+"</li>"}),$(".address_levelthree").html(t),$(".address_levelthree li").click(function(){$(".address_levelthree li").css({"font-weight":"100",color:"rgba(0,0,0,.65)"}).removeClass("levelactive"),$(this).css({"font-weight":"600",color:"rgba(0,0,0,.65)"}).addClass("levelactive"),$("#areaIpt").val($(".address_levelone .levelactive").html()+"/"+$(".address_leveltwo .levelactive").html()+"/"+$(".address_levelthree .levelactive").html()),$("#address_lists").css("display","none")})):$(".address_levelone").html("<li>暂不支持此区域</li>")},error:function(e){console.log(e)}})})):$(".address_levelone").html("<li>暂不支持此区域</li>")},error:function(e){console.log(e)}})})):$(".address_levelone").html("<li>暂不支持此区域</li>")},error:function(e){console.log(e)}})}),$(window).resize(function(){var e,t;"block"==$("#address_lists").css("display")&&(e=$("#areaIpt").offsetParent().offset().left+144,t=$("#areaIpt").offsetParent().offset().top+249,$("#address_list").css("left",e+"px").css("top",t+"px"))}),$("#areaIpt").click(function(e){e.stopPropagation(),$(document).click(function(){$("#address_lists").css("display","none")})}),$(".address_menu").click(function(e){e.stopPropagation(),$(document).click(function(){$("#address_lists").css("display","none")})}),$("#footSubmit").click(function(){$.ajax({url:"../api/changeaddress.php",method:"get",dataType:"json",data:{id:$("#consigneeipt").attr("pid"),uid:$("#consigneeipt").attr("uid"),name:$("#consigneeipt").val(),tel:$("#telIpt").val(),region:$("#areaIpt").val(),address:$("#detailaddIpt").val()},success:function(e){console.log(e),$.ajax({url:"../api/getaddress.php",method:"get",dataType:"json",data:{uid:$("#username").attr("uid")},success:function(e){var t="";e.forEach(function(e){t+="<tr class='address_tr'>\n                        <td>"+e.name+"</td>\n                        <td>"+e.tel+"</td>\n                        <td>"+e.region+"</td>\n                        <td>"+e.address+"</td>\n                        <td pid="+e.id+'>\n                            <span><a href="#">编辑</a></span> |\n                            <span><a href="#">删除</a></span>\n                        </td>\n                    </tr>'}),$("tbody").html(t)},error:function(e){console.log(e)}})},error:function(e){console.log(e)}}),$("#consigneeipt").val(""),$("#telIpt").val(""),$("#areaIpt").val(""),$("#detailaddIpt").val(""),$("#newAdd").fadeOut("fast")})});